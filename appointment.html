<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Book Appointment</title>
<link rel="stylesheet" href="style.css">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="js/firebase.js"></script>
</head>

<body>
<header><h1>Book Your Appointment</h1></header>

<div class="container">
    <label>Name:</label>
    <input type="text" id="name">

    <label>Phone:</label>
    <input type="text" id="phone">

    <label>Date:</label>
    <input type="date" id="date">

    <label>Time:</label>
    <select id="time">
        <script>
            for(let h=9; h<=22; h++){
                let ampm = h<12?'AM':'PM';
                let hour = h>12?h-12:h;
                document.write(`<option>${hour}:00 ${ampm}</option>`);
                document.write(`<option>${hour}:30 ${ampm}</option>`);
            }
        </script>
    </select>

    <button onclick="submitAppointment()">Book Now</button>
</div>

<script>
function submitAppointment(){
    const name=document.getElementById('name').value.trim();
    const phone=document.getElementById('phone').value.trim();
    const date=document.getElementById('date').value;
    const time=document.getElementById('time').value;

    if(!name || !phone || !date || !time){ alert("Please fill all fields"); return; }

    // â­ Double booking prevention
    db.collection("appointments")
      .where("date", "==", date)
      .where("time", "==", time)
      .get()
      .then(q=>{
        if(!q.empty){
            alert("This time is already booked. Please choose another time.");
            return;
        }

        return db.collection("appointments").add({
            name, phone, date, time,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
      })
      .then(()=>{
        window.location.href =
          "confirm.html?name="+encodeURIComponent(name)+
          "&date="+encodeURIComponent(date)+
          "&time="+encodeURIComponent(time);
      })
      .catch(err=>alert(err.message));
}
</script>
</body>
</html>
