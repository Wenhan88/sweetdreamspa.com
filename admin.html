<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<link rel="stylesheet" href="style.css">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="js/firebase.js"></script>
</head>

<body>
<header><h1>Admin Panel</h1></header>

<div class="container">

<div id="loginDiv">
    <p>Admin Login Only</p >
    <input id="email" type="email" placeholder="Email">
    <input id="password" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
</div>

<div id="adminPanel" style="display:none;">
    <h2>Reviews</h2>
    <div id="reviewsList"></div>
    <button onclick="logout()">Logout</button>
</div>

</div>

<script>
function login(){
    const email=document.getElementById('email').value;
    const password=document.getElementById('password').value;

    auth.signInWithEmailAndPassword(email,password)
    .then(()=>{

        // ⭐ RESTRICT ADMIN ACCESS
        if(auth.currentUser.email!=="shiwenhan0525@gmail.com"){
            alert("Unauthorized");
            auth.signOut();
            return;
        }

        document.getElementById('loginDiv').style.display='none';
        document.getElementById('adminPanel').style.display='block';
        loadReviews();
    })
    .catch(e=>alert(e.message));
}

function logout(){
    auth.signOut();
    document.getElementById("loginDiv").style.display="block";
    document.getElementById("adminPanel").style.display="none";
}

function loadReviews(){
    db.collection("reviews").orderBy("timestamp","desc").onSnapshot(snap=>{
        const box=document.getElementById("reviewsList");
        box.innerHTML="";
        snap.forEach(doc=>{
            const d=doc.data();
            box.innerHTML += `
                <div style="border:1px solid #ccc;padding:10px;margin:5px;border-radius:6px;">
                    <strong>${d.name} (${d.rating}★)</strong>
                    <p>${d.comment}</p >
                    <button onclick="deleteReview('${doc.id}')">Delete</button>
                </div>
            `;
        });
    });
}

function deleteReview(id){
    if(confirm("Delete?")){
        db.collection("reviews").doc(id).delete();
    }
}
</script>
</body>
</html>

